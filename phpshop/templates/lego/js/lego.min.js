[].forEach.call(document.querySelectorAll("img[data-src]"), function (img) {
  img.setAttribute("src", img.getAttribute("data-src"));
  img.onload = function () {
    img.removeAttribute("data-src");
  };
});

$(document).ready(function () {




  $(".big-container .template-poruct-list .row .product-block-wrapper-fix").unwrap();

  var body_width = $('body').width();
  if (body_width > 992) {


    if ($(".big-container .template-poruct-list .col-md-3").length) {
      $(".template-poruct-list .product-block-wrapper-fix.col-md-3").css("width", "20%")
      var col_count = 5;
      var $e = $('.template-product-list');
      while ($e.children('.product-block-wrapper-fix').not('.row').length) {
        $e.children('.product-block-wrapper-fix').not('.row').filter(':lt(' + col_count + ')').wrapAll('<div class="row">');
      }

    }
    if ($(".big-container .template-poruct-list .col-md-4").length) {
      $(".template-poruct-list .product-block-wrapper-fix.col-md-4").removeClass("col-md-4").addClass('col-md-3')
      var col_count = 4;
      var $e = $('.template-product-list');
      while ($e.children('.product-block-wrapper-fix').not('.row').length) {
        $e.children('.product-block-wrapper-fix').not('.row').filter(':lt(' + col_count + ')').wrapAll('<div class="row">');

      }
    }
    if ($(".big-container .template-poruct-list .col-md-6").length) {
      $(".template-poruct-list .product-block-wrapper-fix.col-md-6").removeClass("col-md-6").addClass('col-md-4')
      var col_count = 3;
      var $e = $('.template-product-list');
      while ($e.children('.product-block-wrapper-fix').not('.row').length) {
        $e.children('.product-block-wrapper-fix').not('.row').filter(':lt(' + col_count + ')').wrapAll('<div class="row">');
      }
    }
  }
  if (body_width > 768 && body_width < 850) {

    if ($(".big-container .template-poruct-list .col-sm-3").length) {
      $(".template-poruct-list .product-block-wrapper-fix.col-sm-3").removeClass("col-sm-3").addClass('col-sm-4')
      var col_count = 3;
      var $e = $('.template-product-list');
      while ($e.children('.product-block-wrapper-fix').not('.row').length) {
        $e.children('.product-block-wrapper-fix').not('.row').filter(':lt(' + col_count + ')').wrapAll('<div class="row">');
      }
    }



  }
    if (body_width > 350 && body_width < 768) {

    if ($(".template-poruct-list .big-container .col-xs-6").length) {
      var col_count = 2;
      var $e = $('.template-product-list');
      while ($e.children('.product-block-wrapper-fix').not('.row').length) {
        $e.children('.product-block-wrapper-fix').not('.row').filter(':lt(' + col_count + ')').wrapAll('<div class="row">');
      }
    }



  }

  $('#cartlink').click(function () {
    console.log($("#panel1 .swiper-wrapper").length);

  });
  console.log($("#panel1 .swiper-wrapper").length);
  if ($(".carousel-inner .item+.item").length) {
    $(".carousel-control").css("visibility", "visible")
  }

  function modalNowBuy() {
    $(".modal-nowBuy").fadeIn(500).delay(6000).fadeOut(500);


  }

  setTimeout(function () {
    setInterval(
      function () {

        $(".modal-nowBuy").fadeIn(500).delay(7000).fadeOut(500);
      }, 20000);
    modalNowBuy();
  }, 5000);


  if ($(".sidebar-left").hasClass("hide")) {
    $(".main-content").css("width", "100%")
    $(".main-content  .col-md-4").css("width", "25%")
  }
  var now = new Date();
  var night = new Date(
    now.getFullYear(),
    now.getMonth(),
    now.getDate() + 1, // the next day, ...
    0, 0, 0 // ...at 00:00:00 hours
  );
  var msTillMidnight = night.getTime() / 1000 - now.getTime() / 1000;
  var clock = $('.clock').FlipClock({
    language: 'russian',

    coundown: true

  });



  clock.setTime(msTillMidnight); //Устанавливаем нужное время в секундах
  clock.setCountdown(true); //Устанавливаем отсчет времени назад
  clock.start(); //Запускаем отсчет

  $(".catalog > a").on('click', function () {
    /*  $(this).parent("li").children("i").toggleClass("fa-chevron-up");
      $(this).parent("li").children("i").toggleClass("fa-chevron-down");*/
    $(this).siblings("ul").slideToggle();


  });

  $('.grid').masonry({
    // options
    itemSelector: '.grid-item',
    columnWidth: '.grid-item'
  });

  
  
  $('.header-search [data-toggle="popover"]').popover({
    container: '.header-search'
  });
  if ($('.pageCatalContent').is(':empty')) {
    $('.pageCatal').remove();
  }
/*  $(document).click(function (e) {
    if (!$(e.target).is('[data-toggle="popover"], .popover-title, .popover-content')) {
      $('[data-toggle="popover"]').popover('hide');
    }
  });*/

  $(".main-menu-block").appendTo(".menu-wrap .container-fluid");
  $("#catalog-menu ul").removeClass("dropdown-menu", "dropdown-parent");
  $("#catalog-menu ul").removeClass("dropdown-menu-indent-sm");
  $("#catalog-menu ul").removeClass("no-border-radius");
  $("#catalog-menu li").removeClass("dropdown");
  $("#catalog-menu li").removeClass("dropdown-right");
  $("#catalog-menu a").removeClass("sub-marker");
  var pathname = self.location.pathname;
  console.log(pathname);
  $("#catalog-menu li").each(function () {
    var path = $(this)
      .find("a")
      .attr("href");
    if (path === pathname) {
      $(this).addClass("visible-list");
      $(this).children("a").addClass('active-item');
      $(this)
        .parents(".dropdown-parent")
        .addClass("visible-list");
    }

  });
  $(".pageCatal a").each(function () {
    var path = $(this).attr("href");
    if (path === pathname) {

      $(this).addClass('active-item');
      $(this)
        .parents("ul").css("display", "block");
    }

  });

  $("#catalog-menu > li:not(.visible-list)").remove();

  $('.phone').mask('+7(999)-999-9999');
  $('input [tel_new]').mask('+7(999)-999-9999');
  $(".delivOneEl").on("click", function () {
    $(this).addClass('active');

  });

  //navbar
  var previousScroll = 0,
    navBarOrgOffset = $("#navbar").offset().top;

  $("#navigation").height($("#navbar").height());

  $(window).scroll(function () {
    var currentScroll = $(this).scrollTop();

    if (currentScroll > navBarOrgOffset) {
      if (currentScroll > previousScroll) {
        //$("#navigation").hide();
      } else {
        $("#navigation").show();
        $("#navigation").addClass("fixed");

        $(".top-menu").addClass("navbar-fixed-top");
      }
    } else {
      $("#navigation").removeClass("fixed");

      $(".top-menu").removeClass("navbar-fixed-top");
    }
    previousScroll = currentScroll;
	  
	  setTimeout(function() {  
	  $(".top-navbar.fixed .open-menu span").click(function () {
    console.log('go2');
    $(".menu-wrap").addClass('active act');
    $(".menu-wrap").css("position", "fixed");
	 $(".menu-wrap").css("top", "50px");
    $(".menu-wrap").fadeIn("slow")
  });
	  },600);
  
  
  });

  $(".top-navbar:not(.fixed) .open-menu span").mouseenter(function () {
    console.log('go');
    $(".menu-wrap").addClass('active act');

    $(".menu-wrap").fadeIn("slow")
  });

  $(".menu-wrap").mouseleave(function () {
    console.log('back');
    $(".menu-wrap.active").removeClass('active');
	$(".menu-wrap").css("position", "absolute");
	 $(".menu-wrap").css("top", "calc(100% + 50px)");
    $(".menu-wrap").fadeOut("slow");
  });
  $("header .container-fluid:not(.menu-cont)").mouseenter(function () {
    console.log('back 2');
    $(".menu-wrap").removeClass('active');
	$(".menu-wrap").css("position", "absolute");
	 $(".menu-wrap").css("top", "calc(100% + 50px)");
    $(".menu-wrap").fadeOut("slow");
  });
  $(".main-menu-block > li").hover(function () {
    $(function () {
      var s = $(".dropdown-menu-indent-sm > li"),
        width = 0,
        arr = [];
      s.each(function (indx, element) {
        arr[indx] = $(this).width()
        width += arr[indx];
      });
      var s = $(".dropdown-menu-indent-sm > li"),
        height = 0,
        arr = [];
      s.each(function (indx, element) {
        arr[indx] = $(this).height()
        height += arr[indx];
      });
      columns = height / $(".main-menu-block").height();
      console.log("height_old" + columns);
      menuHeight = $(".main-menu-block").height();
      mWidth = columns * 341;
      menuWidth = $(".menu-wrap > div").width() - $(".main-menu-block").width();
      if (mWidth > menuWidth) {
        menuHeight = menuHeight * 1.5
        columns = height / menuHeight;
        mWidth = columns * 341;
        if (mWidth > menuWidth) {
          menuHeight = menuHeight * 1.5;
          $(".main-menu-block").css("height", menuHeight);
        } else {
          $(".main-menu-block").css("height", menuHeight);
        }
      }

      /* if (  
  height > $(".main-menu-block").height() ){
	  console.log("да")
	  }*/


    });

  });

  var text = $('#vendorenabled .panel-body').length;

  $(".panel-body").each(function () {
    var stringText = $(this).html();

    if (stringText === "")
      $(this)
      .parents(".panel")
      .addClass("no-display");
  });

  if ($("#faset-filter-body").html() === "") {
    $(".big-filter-wrapper").remove();
  }
  if ($(".bx-pager").html() === "") {
    $(".controls").remove();
  }
  if ($(".bx-pager").html() === "") {
    $(".wrap").remove();
  }

  $(".back").on("click", function () {
    $(".back").removeClass("active");
    $(".dropdown-menu").removeClass("active");
    $(".dropdown-menu .dropdown-menu").removeClass("subactive");
    $(".hidden-menu i").removeClass("no-display");
    $(".hidden-menu li").removeClass("no-display");
  });
  $(".btn-menu").on("click", function () {
    $(".back").removeClass("active");
    $(".dropdown-menu").removeClass("active");

    $(".hidden-menu li").removeClass("no-display");
    $(".hidden-menu i").removeClass("no-display");
  });






  $(".swiper-container > .swiper-wrapper  .product-block-wrapper-fix").unwrap();
  $(".main-content .catalog-wrap").unwrap();
  $(".swiper-container > .swiper-wrapper > div").addClass("swiper-slide");
  $(".brands-slider > .swiper-wrapper > li").addClass("swiper-slide");
  if ($("#panel1 .product-block-wrapper-fix").length) {
    $("#panel2").removeClass("active");
    $("#panel2").removeClass("in");
  } else {



    var swiper1 = new Swiper(".active .spec-main-slider", {
      slidesPerView: 6,
      speed: 800,
      nextButton: ".btn-next2",
      prevButton: ".btn-prev2",
      preventClicks: false,
      effect: "slide",
      preventClicksPropagation: false,
      breakpoints: {
        550: {
          slidesPerView: 2
        },
        730: {
          slidesPerView: 2
        },
        950: {
          slidesPerView: 3
        },
        1180: {
          slidesPerView: 4
        },
        1300: {
          slidesPerView: 5
        },
        1500: {
          slidesPerView: 6
        }
      }
    });

  }
  var swiper4 = new Swiper(".nowBuy-slider", {
    slidesPerView: 6,
    speed: 800,
    nextButton: ".btn-next4",
    prevButton: ".btn-prev4",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      550: {
        slidesPerView: 2
      },
      730: {
        slidesPerView: 2
      },
      950: {
        slidesPerView: 3
      },
      1180: {
        slidesPerView: 4
      },
      1300: {
        slidesPerView: 5
      },
      1500: {
        slidesPerView: 5
      }
    }
  });
  var swiper5 = new Swiper(".brands-slider", {
    slidesPerView: 6,
    speed: 800,
    nextButton: ".btn-next5",
    prevButton: ".btn-prev5",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      550: {
        slidesPerView: 2
      },
      800: {
        slidesPerView: 4
      },
      1000: {
        slidesPerView: 4
      },
      1080: {
        slidesPerView: 4
      },
      1200: {
        slidesPerView: 4
      },
      1500: {
        slidesPerView: 5
      }
    }
  });
  var swiper5 = new Swiper(".compare-slider", {
    slidesPerView: 4,
    speed: 800,
    nextButton: ".btn-next9",
    prevButton: ".btn-prev9",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      550: {
        slidesPerView: 2
      },
      850: {
        slidesPerView: 3
      },
      1000: {
        slidesPerView: 4
      },
      1080: {
        slidesPerView: 3
      },
      1200: {
        slidesPerView: 3
      },
      1500: {
        slidesPerView: 4
      }
    }
  });
  var swiper2 = new Swiper(".spec-main-icon-slider", {
    slidesPerView: 6,
    speed: 800,
    nextButton: ".btn-next3",
    prevButton: ".btn-prev3",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      550: {
        slidesPerView: 2
      },
      730: {
        slidesPerView: 2
      },
      950: {
        slidesPerView: 3
      },
      1180: {
        slidesPerView: 4
      },
      1300: {
        slidesPerView: 5
      },
      1500: {
        slidesPerView: 6
      }
    }
  });
  var swiper3 = new Swiper(".spec-hit-slider", {
    slidesPerView: 6,
    speed: 800,
    nextButton: ".btn-next1",
    prevButton: ".btn-prev1",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      550: {
        slidesPerView: 2
      },
      730: {
        slidesPerView: 2
      },
      950: {
        slidesPerView: 3
      },
      1180: {
        slidesPerView: 4
      },
      1300: {
        slidesPerView: 5
      },
      1500: {
        slidesPerView: 6
      }
    }
  });
  var swiper6 = new Swiper(".inner-nowbuy .last-slider", {
    slidesPerView: 4,
    speed: 800,
    nextButton: ".btn-next3",
    prevButton: ".btn-prev3",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      450: {
        slidesPerView: 1
      },
      550: {
        slidesPerView: 2
      },
      730: {
        slidesPerView: 2
      },
      950: {
        slidesPerView: 3
      },
      1180: {
        slidesPerView: 3
      },
      1300: {
        slidesPerView: 3
      },
      1500: {
        slidesPerView: 4
      }
    }
  });
  var swiper6 = new Swiper(".inner-nowbuy .nowBuy-slider", {
    slidesPerView: 4,
    speed: 800,
    nextButton: ".btn-next4",
    prevButton: ".btn-prev4",
    preventClicks: false,
    effect: "slide",

    preventClicksPropagation: false,
    breakpoints: {
      450: {
        slidesPerView: 1
      },
      550: {
        slidesPerView: 2
      },
      730: {
        slidesPerView: 2
      },
      950: {
        slidesPerView: 3
      },
      1180: {
        slidesPerView: 3
      },
      1300: {
        slidesPerView: 3
      },
      1500: {
        slidesPerView: 4
      }
    }
  });

  $("#actionTab li:nth-child(3)").click(function () {
    setTimeout(function () {
      var swiper1 = new Swiper(".spec-main-slider", {
        slidesPerView: 6,
        speed: 800,
        nextButton: ".btn-next2",
        prevButton: ".btn-prev2",
        preventClicks: false,
        effect: "slide",
        preventClicksPropagation: false,
        breakpoints: {
          550: {
            slidesPerView: 2
          },
          730: {
            slidesPerView: 2
          },
          950: {
            slidesPerView: 3
          },
          1180: {
            slidesPerView: 4
          },
          1300: {
            slidesPerView: 5
          },
          1500: {
            slidesPerView: 6
          }
        }
      });
    }, 400);
  });


});